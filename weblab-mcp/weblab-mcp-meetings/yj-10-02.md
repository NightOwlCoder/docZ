# YJ Jiang (yimingj)
# Thu, October 2 | 03:00 PM - 03:30 PM PDT
The team conducted a technical planning session to discuss implementing MCP (Model Control Protocol) for WebLab data access through Westlake. The meeting focused on adapting to Amazon's new mandate requiring remote-first architecture, moving away from local Python script implementations to cloud-based agents. Key discussion points included data access methods, infrastructure considerations, and potential use cases for automated WebLab management. 

## Architecture and Data Access Strategy 
The team explored two primary approaches for data access: direct integration with Redshift clusters and leveraging Athena's existing MCP server. The Redshift approach offers proven functionality with existing CDK deployment capabilities, allowing for easy scaling through compute adjustments. The Athena MCP server option could potentially eliminate infrastructure costs by utilizing existing metadata and auto-approval processes. Current Westlake 1.0 tables present challenges with data modeling and overlapping information, while the new Westlake 2.0 initiative uses dimensional modeling to create more structured, machine-readable data with proper documentation. 

## Use Cases and User Experience 
Several practical use cases were identified, including automated TA detection across WebLab experiments and ad hoc reporting for project managers and technical staff. The team recognized the need for an agent-based interface rather than direct MCP access for most users, as raw data queries require significant domain knowledge. A natural language query interface has already been developed internally, demonstrating the feasibility of this approach. The discussion emphasized the importance of question refinement and preprocessing to ensure meaningful results from complex organizational data. 

## Infrastructure and Performance Considerations 
Latency concerns were addressed, with the team noting that users have become more tolerant of higher response times due to agent-based interactions. The current Redshift cluster has been downsized for cost optimization but can be scaled up as needed for production traffic. Throughput limitations and cost management strategies were discussed, including potential throttling mechanisms and monitoring capabilities to track usage patterns and identify excessive access.

## Decisions
-   Adopt remote-first architecture for MCP implementation as mandated by Amazon
-   Focus on Redshift cluster integration as the primary data access method
-   Investigate using Athena's MCP server to avoid infrastructure costs
-   Prioritize Westlake 2.0 dimensional modeling approach for better data structure

## Next Steps
-   Connect with Arpit to discuss Athena MCP server integration possibilities
-   Talk to Kevin about CDK deployment for Redshift cluster scaling
-   Review existing natural language query UI developed by intern
-   Collect and document additional use cases from leadership requests
-   Explore agent-based user interface on top of MCP tools

# Slack Thread
YJ sent me some additional info via Slack after our meeting ended:

YJ Jiang:
talk to @crusekev for redshift CDK details, and the best way to query WSTLake systematically.

YJ Jiang:
> **Dave Moore**  \[9:14 AM]\
> Hi YJ, Vignesh sent you a note/email thread about getting me access to the wstlake weblab tables for running some analysis for Prakash, our VP (former CBA VP). I had two kind of high level questions or needs; one is just the base thing of getting access to tables and way to query the tables, and the second is if you happen to have any queries or reports that would serve as a good starting point for me to build queries for what he is looking for. (essentially - find weblabs with large, stat sig results of CP pos/neg and that were launched or dialed up to 100%. The important part here is more getting some results even if may miss many things that weren't dialed up or documented cleanly.
>> YJ Jiang
>> our answer:**Kevin Cruse**  \[3:51 PM]\
>> Hey Dave--here's a query that, for each weblab-marketplace whose latest state YTD is "launched", finds the most "relevant" CP 2 day result and orders them by the lower bound of the confidence interval descending, effectively listing the most "statistically significant" positively impacting weblabs. I'm still doing some testing and am seeing some interesting anomalies with regard to the impacts, but this should give you a good starting point. If you'd like to filter the set of weblabs to something more relevant to your org, you can join with [weblab\_metadata](https://w.amazon.com/bin/view/Weblab/Wstlake/#Hweblab_ddl.weblab_metadata) and filter on appropriate attributes there. You can order by the upper bound of the confidence interval ascending to retrieve the most negatively impacting weblabs.
>> 
>> ```
>> WITH
>>     activation_events AS (
>>         SELECT
>>             weblab,
>>             marketplace_id,
>>             launched_treatment,
>>             event_time,
>>             activation_state,
>>             ROW_NUMBER() OVER (
>>                 PARTITION BY
>>                     weblab,
>>                     marketplace_id
>>                 ORDER BY event_time DESC
>>             ) AS event_rank
>>         FROM andes.weblab_ddl.activation_events
>>         WHERE
>>             domain = 'prod'
>>             AND event_time >= '2025-01-01'
>>     ),
>>     analysis_results AS (
>>         SELECT
>>             activation_events.weblab,
>>             activation_events.marketplace_id,
>>             activation_events.launched_treatment,
>>             activation_events.event_time AS launched_time,
>>             analysis_results.posterior_annualized_ci_lower AS annualized_cp_lower,
>>             analysis_results.posterior_annualized_impact AS annualized_cp_mean,
>>             analysis_results.posterior_annualized_ci_upper AS annualized_cp_upper,
>>             analysis_results.job_id,
>>             ROW_NUMBER() OVER (
>>                 PARTITION BY
>>                     activation_events.weblab,
>>                     activation_events.marketplace_id
>>                 ORDER BY
>>                     analysis_results.analysis_end_date DESC,
>>                     analysis_results.analysis_completed_time DESC
>>             ) AS result_rank
>>         FROM
>>             activation_events
>>             JOIN andes.weblab_ddl.weblab_analysis_results AS analysis_results ON
>>                 activation_events.weblab = analysis_results.experiment_id
>>                 AND activation_events.marketplace_id = analysis_results.marketplace_id
>>                 AND activation_events.launched_treatment = analysis_results.measured_treatment
>>                 AND activation_events.event_time >= analysis_results.analysis_end_date
>>         WHERE
>>             activation_events.activation_state = 'launch'
>>             AND activation_events.event_rank = 1
>>             AND analysis_results.reference_treatment = 'C'
>>             AND analysis_results.metric_uuid = 'ef3cc3f4-2bda-4191-a80a-c85016d3f352' -- Contribution Profit 2 Day Delay
>>             AND analysis_results.aggregation_type = 'overall'
>>             AND analysis_results.model = 'regression'
>>             AND analysis_results.dimensions_string = 'all:all'
>>             AND analysis_results.segmentation_id = 'all'
>>             AND analysis_results.trigger_source_id IN ('Customer Weblab', 'Session Weblab')
>>             AND analysis_results.active_alarm_names IS NULL
>>             AND analysis_results.reference_sample_count > 500
>>             AND analysis_results.measured_sample_count > 500
>>             AND analysis_results.posterior_annualized_ci_lower IS NOT NULL
>>             AND analysis_results.posterior_annualized_impact IS NOT NULL
>>             AND analysis_results.posterior_annualized_ci_upper IS NOT NULL
>>     )
>> SELECT
>>     weblab,
>>     marketplace_id,
>>     launched_treatment,
>>     launched_time,
>>     annualized_cp_lower,
>>     annualized_cp_mean,
>>     annualized_cp_upper,
>>     job_id
>> FROM analysis_results
>> WHERE result_rank = 1
>> ORDER BY annualized_cp_lower DESC
>> LIMIT 100
>> ```
>> 
>> this is an ad-hoc query and it took us about 3 days for formulate.

YJ Jiang
> **Abhi Gupta**  \[11:07 PM]\
> hey YJ, thanks for your message. I am collecting data on how weblab policy enforcement on Cart page has helped (or not helped) us as page/policy owners. I need to share the same with our leaders to align them to expand the policy to checkout experiments.I am looking to get a report on what experiments launched in cart in last 6 months with the impact metrics that relate to core store metrics (OPS, CSales, GCCP ) and:
> 
> 1.  Indicate if experiment met policy, used a SEV-2 override, or had approved exceptions.
> 2.  Experiment change type
> 3.  Link to the weblab so that I can see more detail.
> 4.  By business area
> 
> try our beta natural language query assistant:
> https://beta.console.harmony.a2z.com/weblab-data-management/wstlake-query